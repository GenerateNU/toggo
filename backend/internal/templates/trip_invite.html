<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>{{ .PageTitle }}</title>
  <meta name="description" content="{{ .MetaDescription }}" />
  <meta property="og:title" content="{{ .PageTitle }}" />
  <meta property="og:description" content="{{ .MetaDescription }}" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ .CanonicalURL }}" />
  {{ if .MetaImage }}<meta property="og:image" content="{{ .MetaImage }}" />{{ end }}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ .PageTitle }}" />
  <meta name="twitter:description" content="{{ .MetaDescription }}" />
  {{ if .MetaImage }}<meta name="twitter:image" content="{{ .MetaImage }}" />{{ end }}

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { toggo: "#FF7E00" } } }
    }
  </script>

  <style>
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUpCenter {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUpBottom {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 300ms ease-out both; }

    /* Mobile: bottom sheet full width */
    .modal-wrapper {
      animation: slideUpBottom 500ms cubic-bezier(0.16, 1, 0.3, 1) 150ms both;
      width: 100%;
    }
    .modal-container {
      position: fixed; inset: 0; z-index: 50;
      display: flex;
      align-items: flex-end;
      justify-content: stretch;
      padding: 0;
      max-width: 100vw;
    }

    /* KEY FIX: no fixed heights; just cap to viewport and allow scrolling */
    .modal-card {
      width: 100%;
      max-width: 100%;
      border-radius: 1.5rem 1.5rem 0 0;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;

      /* cap to viewport (dynamic, not "fixed height") */
      max-height: calc(100dvh - env(safe-area-inset-top, 0) - 0.75rem);
      overflow: hidden; /* keep rounded corners clean; inner scrolls */
    }

    /* Inner scroll area */
    .modal-card .modal-card-inner {
      flex: 1;
      min-height: 0;           /* allows scrolling child in flex */
      overflow-y: auto;        /* scroll when content exceeds */
      -webkit-overflow-scrolling: touch;
      padding-bottom: max(1rem, env(safe-area-inset-bottom, 0));
    }

    .modal-card .modal-card-actions {
      margin-top: auto;
      padding-top: 1rem;
    }

    /* Desktop: centered modal */
    @media (min-width: 640px) {
      .modal-wrapper {
        animation: slideUpCenter 500ms cubic-bezier(0.16, 1, 0.3, 1) 150ms both;
      }
      .modal-container {
        align-items: center;
        padding: 1rem;
      }
      .modal-card {
        max-width: 400px;
        border-radius: 1rem;

        /* still cap to viewport on desktop too */
        max-height: calc(100dvh - 2rem);
      }
      .modal-card .modal-card-inner {
        padding-bottom: 0;
      }
    }
  </style>
</head>

<!-- remove overflow-hidden so fixed overlay/sheet doesn't get clipped -->
<body class="min-h-[100dvh] font-sans antialiased bg-gradient-to-b from-white via-slate-50 to-blue-50/40 overflow-x-hidden">

  <!-- Flight path decorations (background) -->
  <svg class="absolute inset-0 w-full h-full pointer-events-none" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
    <path d="M -40,220 Q 200,100 520,180" fill="none" stroke="#d1d5db" stroke-width="1.5" stroke-dasharray="10 8" />
    <g transform="translate(500,182) rotate(-15)">
      <polygon points="0,-6 14,0 0,6 3,0" fill="#c4c8cf" />
    </g>
    <path d="M -20,580 Q 260,480 540,560" fill="none" stroke="#d1d5db" stroke-width="1.5" stroke-dasharray="10 8" />
    <g transform="translate(10,578) rotate(20)">
      <polygon points="0,-6 14,0 0,6 3,0" fill="#c4c8cf" />
    </g>
  </svg>

  <!-- Logo -->
  <div class="fixed top-0 left-0 right-0 z-30 flex items-center justify-center pt-6">
    <img src="/static/toggo_logo.svg" alt="toggo" class="w-40 opacity-40" />
  </div>

  <!-- Overlay -->
  <div class="fixed inset-0 z-40 bg-black/40 backdrop-blur-sm fade-in"></div>

  <!-- Modal -->
  <div class="modal-container">
    <div class="modal-wrapper">
      <article class="modal-card bg-white shadow-2xl">
        {{ if .Data.ErrorMessage }}
        <div class="modal-card-inner p-6">
          <h2 class="text-lg font-bold text-zinc-900 mb-2">Invite unavailable</h2>
          <p class="text-sm leading-relaxed text-zinc-500 mb-5">{{ .Data.ErrorMessage }}</p>
          <div class="modal-card-actions">
            <a href="/join" class="block w-full rounded-xl bg-toggo px-4 py-3 text-center text-sm font-semibold text-white shadow-lg shadow-orange-200/50 hover:bg-orange-500 active:scale-[0.98] transition">
              Enter a different code
            </a>
          </div>
        </div>
        {{ else }}
        <div class="modal-card-inner p-6">
          <h2 class="text-xl font-bold text-zinc-900 mb-4">{{ .Data.TripName }}</h2>

          <!-- Members -->
          <div class="flex items-center gap-2 mb-4">
            <svg class="w-5 h-5 shrink-0 text-zinc-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            <span class="text-[0.8125rem] text-zinc-500">
              {{ .Data.MemberCount }} member{{ if gt .Data.MemberCount 1 }}s{{ end }}
            </span>
          </div>

          <!-- Cover image -->
          <div class="h-40 overflow-hidden rounded-xl bg-zinc-100 mb-4">
            {{ if .Data.CoverImageURL }}
            <img src="{{ .Data.CoverImageURL }}" alt="Trip cover" class="h-full w-full object-cover" />
            {{ else }}
            <div class="flex h-full w-full items-center justify-center text-sm text-zinc-400">No cover image</div>
            {{ end }}
          </div>

          <div class="flex items-center gap-3 mb-5">
            {{ if .Data.InviterProfilePictureURL }}
            <img src="{{ .Data.InviterProfilePictureURL }}" alt="{{ .Data.InviterName }}" class="w-10 h-10 rounded-full object-cover shrink-0" />
            {{ else if .Data.InviterName }}
            <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-toggo text-sm font-semibold text-white shrink-0">{{ printf "%.1s" .Data.InviterName }}</span>
            {{ end }}
            <p class="text-sm leading-relaxed text-zinc-500">
              {{ if .Data.InviterName }}<span class="font-medium text-zinc-700">{{ .Data.InviterName }}</span> wants you along for {{ else }}You've been invited to join {{ end }}<span class="font-medium text-zinc-700">{{ .Data.TripName }}</span>.
            </p>
          </div>

          <div class="modal-card-actions">
            <a href="{{ .Data.DeepLink }}" class="block w-full rounded-xl bg-toggo px-4 py-3.5 text-center text-sm font-semibold text-white shadow-lg shadow-orange-200/50 hover:bg-orange-500 active:scale-[0.98] transition">
              Open in Toggo
            </a>
            <a href="#" class="block w-full rounded-xl border border-zinc-200 bg-white px-4 py-3.5 text-center text-sm font-semibold text-zinc-700 hover:bg-zinc-50 active:scale-[0.98] transition mt-2.5">
              Download Toggo
            </a>
            <a href="/join" class="block text-center text-xs text-zinc-400 hover:text-zinc-500 hover:underline mt-4">
              Enter a different code
            </a>
          </div>
        </div>
        {{ end }}
      </article>
    </div>
  </div>
</body>
</html>